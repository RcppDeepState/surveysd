<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Iterative Proportional Fitting • surveysd</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Iterative Proportional Fitting">
<meta property="og:description" content="surveysd">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">surveysd</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/surveysd.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/error_estimation.html">Error estimation</a>
    </li>
    <li>
      <a href="../articles/ipf.html">Iterative Proportional Fitting</a>
    </li>
    <li>
      <a href="../articles/methodology.html">Methodology</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/statistikat/surveysd/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Iterative Proportional Fitting</h1>
                        <h4 class="author">Gregor de Cillia</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/statistikat/surveysd/blob/master/vignettes/ipf.Rmd"><code>vignettes/ipf.Rmd</code></a></small>
      <div class="hidden name"><code>ipf.Rmd</code></div>

    </div>

    
    
<p>This vignette explains the usage of the <code><a href="../reference/ipf.html">ipf()</a></code> function, which has been used for calibrating the labour force survey of Austria for several years. It is based on the Iterative Proportional Fitting algorithm and gives some flexibility about the details of the implementation. See <span class="citation">(Meraner, Gumprecht, and Kowarik 2016)</span> or <code><a href="../articles/methodology.html">vignette("methodology")</a></code> for more details.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>We will assume the output of <code><a href="../reference/demo.eusilc.html">demo.eusilc()</a></code> is our population. From this population, a sample without replacement is drawn. The sample covers 10 percent of the population. We assign a weight of one for all observations of the population and a weight of ten for all observations of the sample.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/statistikat/surveysd">surveysd</a></span>)
<span class="kw">population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/demo.eusilc.html">demo.eusilc</a></span>(<span class="fl">1</span>, prettyNames = <span class="fl">TRUE</span>)
<span class="kw">population</span>[, <span class="kw">pWeight</span> <span class="op">:=</span> <span class="fl">1</span>]
<span class="kw">pop_sample</span> <span class="op">&lt;-</span> <span class="kw">population</span>[<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span><span class="op">:</span><span class="kw">.N</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="kw">.N</span><span class="op">*</span><span class="fl">0.10</span>)), ]
<span class="kw">pop_sample</span>[, <span class="kw">pWeight</span> <span class="op">:=</span> <span class="fl">10</span>]
</pre></div>
</div>
<div id="one-constraint-one-variable" class="section level2">
<h2 class="hasAnchor">
<a href="#one-constraint-one-variable" class="anchor"></a>One constraint, one variable</h2>
<p>We will start with an example where we want to adapt the weights of <code>pop_sample</code> such that the weighted number of males and females matches the ones of <code>population</code>. We can see that this is currently not the case.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
(<span class="kw">gender_distribution</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">gender</span>, <span class="kw">population</span>))
<span class="co">#&gt; gender</span>
<span class="co">#&gt;   male female </span>
<span class="co">#&gt;   7267   7560</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">gender</span>, <span class="kw">pop_sample</span>)
<span class="co">#&gt; gender</span>
<span class="co">#&gt;   male female </span>
<span class="co">#&gt;   7570   7250</span>
</pre></div>
<p>Due to random sampling (rather than stratified sampling), there are differences between the gender distributions. We can pass <code>gender_distribution</code> as a parameter to <code><a href="../reference/ipf.html">ipf()</a></code> to obtain modified weights.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">pop_sample_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ipf.html">ipf</a></span>(<span class="kw">pop_sample</span>, conP = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">gender_distribution</span>), w = <span class="st">"pWeight"</span>)
</pre></div>
<p>The resulting dataset, <code>pop_sample_c</code> is similar to <code>pop_sample</code> but has an additional column with the adjusted weights.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw">pop_sample</span>)
<span class="co">#&gt; [1] 1482   30</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw">pop_sample_c</span>)
<span class="co">#&gt; [1] 1482   31</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setops.html">setdiff</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">pop_sample_c</span>), <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">pop_sample</span>))
<span class="co">#&gt; [1] "calibWeight"</span>
</pre></div>
<p>We can now calculate the weighted number of males and females according to this new weight. This will result in a match for the constraints.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">calibWeight</span> <span class="op">~</span> <span class="kw">gender</span>, <span class="kw">pop_sample_c</span>)
<span class="co">#&gt; gender</span>
<span class="co">#&gt;   male female </span>
<span class="co">#&gt;   7267   7560</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">gender</span>, <span class="kw">population</span>)
<span class="co">#&gt; gender</span>
<span class="co">#&gt;   male female </span>
<span class="co">#&gt;   7267   7560</span>
</pre></div>
<p>In this simple case, <code>ipf</code> just performs a post stratification step. This means, that all males and all females have the same weight.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="op">~</span> <span class="kw">calibWeight</span> <span class="op">+</span> <span class="kw">gender</span>, <span class="kw">pop_sample_c</span>)
<span class="co">#&gt;                   gender</span>
<span class="co">#&gt; calibWeight        male female</span>
<span class="co">#&gt;   9.5997357992074   757      0</span>
<span class="co">#&gt;   10.4275862068966    0    725</span>
</pre></div>
<p>All males have been weighted down (<code>calibWeight &lt; 10</code>) to compensate for the overrepresentation in the sample.</p>
</div>
<div id="one-constraint-two-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#one-constraint-two-variables" class="anchor"></a>One constraint, two variables</h2>
<p>Let’s now assume that we want to put constraints on the number of males and females for each age group. The numbers from the original population can be obtained with <code><a href="https://rdrr.io/r/stats/xtabs.html">xtabs()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
(<span class="kw">con_ga</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">gender</span> <span class="op">+</span> <span class="kw">age</span>, <span class="kw">population</span>))
<span class="co">#&gt;         age</span>
<span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span>
<span class="co">#&gt;   male        1528     855    2165    1822       897</span>
<span class="co">#&gt;   female      1375     848    2255    1845      1237</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">gender</span> <span class="op">+</span> <span class="kw">age</span>, <span class="kw">pop_sample</span>)
<span class="co">#&gt;         age</span>
<span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span>
<span class="co">#&gt;   male        1690     820    2090    1900      1070</span>
<span class="co">#&gt;   female      1410     840    2010    1830      1160</span>
</pre></div>
<p>Again, we can see that those constraints are not met. Supplying the contingency table <code>con_ga</code> to <code><a href="../reference/ipf.html">ipf()</a></code> will again resolve this.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">pop_sample_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ipf.html">ipf</a></span>(<span class="kw">pop_sample</span>, conP = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">con_ga</span>), w = <span class="st">"pWeight"</span>)
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">gender</span> <span class="op">+</span> <span class="kw">age</span>, <span class="kw">population</span>)
<span class="co">#&gt;         age</span>
<span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span>
<span class="co">#&gt;   male        1528     855    2165    1822       897</span>
<span class="co">#&gt;   female      1375     848    2255    1845      1237</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">calibWeight</span> <span class="op">~</span> <span class="kw">gender</span> <span class="op">+</span> <span class="kw">age</span>, <span class="kw">pop_sample_c2</span>)
<span class="co">#&gt;         age</span>
<span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span>
<span class="co">#&gt;   male        1528     855    2165    1822       897</span>
<span class="co">#&gt;   female      1375     848    2255    1845      1237</span>
</pre></div>
</div>
<div id="two-constraints" class="section level2">
<h2 class="hasAnchor">
<a href="#two-constraints" class="anchor"></a>Two constraints</h2>
<p>Now we assume that we know the number of persons living in each nuts2 region from registry data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">registry_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">region</span>, <span class="kw">population</span>)
</pre></div>
<p>However, those registry data does not provide any information about age or <code>gender</code>. Therefore, the two contingency tables (<code>con_ga</code> and <code>registry_table</code>) have to be specified independently. This can be done by supplying a list to <code>conP</code></p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">pop_sample_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ipf.html">ipf</a></span>(<span class="kw">pop_sample</span>, conP = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">con_ga</span>, <span class="kw">registry_table</span>), w = <span class="st">"pWeight"</span>)
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">gender</span> <span class="op">+</span> <span class="kw">age</span>, <span class="kw">population</span>)
<span class="co">#&gt;         age</span>
<span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span>
<span class="co">#&gt;   male        1528     855    2165    1822       897</span>
<span class="co">#&gt;   female      1375     848    2255    1845      1237</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">calibWeight</span> <span class="op">~</span> <span class="kw">gender</span> <span class="op">+</span> <span class="kw">age</span>, <span class="kw">pop_sample_c2</span>)
<span class="co">#&gt;         age</span>
<span class="co">#&gt; gender   (-Inf,16]   (16,25]   (25,45]   (45,65] (65, Inf]</span>
<span class="co">#&gt;   male   1528.0009  855.0002 2165.0006 1821.9996  896.9998</span>
<span class="co">#&gt;   female 1375.0001  847.9994 2254.9994 1845.0002 1236.9999</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">region</span>, <span class="kw">population</span>)
<span class="co">#&gt; region</span>
<span class="co">#&gt;    Burgenland     Carinthia Lower Austria      Salzburg        Styria </span>
<span class="co">#&gt;           549          1078          2804           924          2295 </span>
<span class="co">#&gt;         Tyrol Upper Austria        Vienna    Vorarlberg </span>
<span class="co">#&gt;          1317          2805          2322           733</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">calibWeight</span> <span class="op">~</span> <span class="kw">region</span>, <span class="kw">pop_sample_c2</span>)
<span class="co">#&gt; region</span>
<span class="co">#&gt;    Burgenland     Carinthia Lower Austria      Salzburg        Styria </span>
<span class="co">#&gt;           549          1078          2804           924          2295 </span>
<span class="co">#&gt;         Tyrol Upper Austria        Vienna    Vorarlberg </span>
<span class="co">#&gt;          1317          2805          2322           733</span>
</pre></div>
<p>this time, the constraints are not matched perfectly. That is, because we provided more than one constraint. therefore, the <code><a href="../reference/ipf.html">ipf()</a></code> algorithm had to work iteratively.</p>
</div>
<div id="household-constraints" class="section level2">
<h2 class="hasAnchor">
<a href="#household-constraints" class="anchor"></a>Household Constraints</h2>
<p>If the dataset has a household structure, household constraints can be passed via the parameter <code>conH</code>. If this parameter is used, it is also necessary to supply <code>hid</code>, which defines the column names that contains household ids.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
(<span class="kw">conH1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">pWeight</span> <span class="op">~</span> <span class="kw">hsize</span> <span class="op">+</span> <span class="kw">region</span>, data = <span class="kw">population</span>[<span class="op">!</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">duplicated</a></span>(<span class="kw">hid</span>)]))
<span class="co">#&gt;          region</span>
<span class="co">#&gt; hsize     Burgenland Carinthia Lower Austria Salzburg Styria Tyrol</span>
<span class="co">#&gt;   (0,1]           58       117           325      103    264   118</span>
<span class="co">#&gt;   (1,2]           82       126           345      102    260   149</span>
<span class="co">#&gt;   (2,3]           37        80           189       55    187    79</span>
<span class="co">#&gt;   (3,4]           33        63           169       71    122   102</span>
<span class="co">#&gt;   (4,5]           14        22            82       18     49    37</span>
<span class="co">#&gt;   (5,Inf]          2        17            21       12     34    11</span>
<span class="co">#&gt;          region</span>
<span class="co">#&gt; hsize     Upper Austria Vienna Vorarlberg</span>
<span class="co">#&gt;   (0,1]             262    431         67</span>
<span class="co">#&gt;   (1,2]             321    355         72</span>
<span class="co">#&gt;   (2,3]             203    175         44</span>
<span class="co">#&gt;   (3,4]             168     96         53</span>
<span class="co">#&gt;   (4,5]              79     35         27</span>
<span class="co">#&gt;   (5,Inf]            35     15          7</span>
<span class="kw">pop_sample_hh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ipf.html">ipf</a></span>(<span class="kw">pop_sample</span>, hid = <span class="st">"hid"</span>, conH = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">conH1</span>), w = <span class="st">"pWeight"</span>,
                     bound = <span class="fl">10</span>)
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="kw">calibWeight</span> <span class="op">~</span> <span class="kw">hsize</span> <span class="op">+</span> <span class="kw">region</span>, data = <span class="kw">pop_sample_hh</span>[<span class="op">!</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">duplicated</a></span>(<span class="kw">hid</span>)])
<span class="co">#&gt;          region</span>
<span class="co">#&gt; hsize     Burgenland Carinthia Lower Austria Salzburg Styria Tyrol</span>
<span class="co">#&gt;   (0,1]           58       117           325      103    264   118</span>
<span class="co">#&gt;   (1,2]           82       126           345      102    260   149</span>
<span class="co">#&gt;   (2,3]           37        80           189       55    187    79</span>
<span class="co">#&gt;   (3,4]           33        63           169       71    122   102</span>
<span class="co">#&gt;   (4,5]           14        22            82       18     49    37</span>
<span class="co">#&gt;   (5,Inf]          2        17            21       12     34    11</span>
<span class="co">#&gt;          region</span>
<span class="co">#&gt; hsize     Upper Austria Vienna Vorarlberg</span>
<span class="co">#&gt;   (0,1]             262    431         67</span>
<span class="co">#&gt;   (1,2]             321    355         72</span>
<span class="co">#&gt;   (2,3]             203    175         44</span>
<span class="co">#&gt;   (3,4]             168     96         53</span>
<span class="co">#&gt;   (4,5]              79     35         27</span>
<span class="co">#&gt;   (5,Inf]            35     15          7</span>
</pre></div>
</div>
<div id="tolerances" class="section level2">
<h2 class="hasAnchor">
<a href="#tolerances" class="anchor"></a>Tolerances</h2>
<p>If <code>conP</code> or <code>conH</code> contain several contingency tables or if <code>conP</code> and <code>conH</code> are used at the same time, the ipf algorithm will operate iteratively. This means that the calibrated dataset will satisfy the constraints only approximately. The default tolerances of the approximation can be overwritten using the parameters <code>conP</code> and <code>conH</code>.</p>
<p>Lowering the tolerances will improve the match between the constraints and the contingency tables according to the calibrated weights. However, lower tolerances will also make it so more iterations are necessary until a convergence is met. If the constraints are too small, ipf will return with a warning that indicates that a convergence could not be reached.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="../reference/ipf.html">ipf</a></span>(<span class="kw">pop_sample</span>, conP = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">con_ga</span>, <span class="kw">registry_table</span>), w = <span class="st">"pWeight"</span>,
    verbose = <span class="fl">TRUE</span>, epsP = <span class="fl">0.01</span>)
<span class="co">#&gt; Iteration stopped after 2 steps</span>
<span class="co">#&gt; Convergence reached</span>
<span class="fu"><a href="../reference/ipf.html">ipf</a></span>(<span class="kw">pop_sample</span>, conP = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">con_ga</span>, <span class="kw">registry_table</span>), w = <span class="st">"pWeight"</span>,
    verbose = <span class="fl">TRUE</span>, epsP = <span class="fl">0.0001</span>)
<span class="co">#&gt; Iteration stopped after 3 steps</span>
<span class="co">#&gt; Convergence reached</span>
</pre></div>
<p>We see that changing the tolerances from <code>0.01</code> (one percent) to <code>0.0001</code> increases the number of required iterations.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-mekogu2016">
<p>Meraner, Angelika, Daniela Gumprecht, and Alexander Kowarik. 2016. “Weighting Procedure of the Austrian Microcensus Using Administrative Data.” <em>Austrian Journal of Statistics</em> 45 (June): 3. <a href="https://doi.org/10.17713/ajs.v45i3.120" class="uri">https://doi.org/10.17713/ajs.v45i3.120</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Johannes Gussenbauer, Alexander Kowarik, Gregor de Cillia.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
